<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="author" content="Lindsey Smith"><meta name="description" content="My name is Lindsey and I work as a full stack software engineer, currently getting my hands dirty with Python and JavaScript at Udacity. I wrote pretty frequently about my time at Hack Reactor, a software engineering bootcamp. Now I blog a mixture of programming, women in tech, life, and cats."><title>D3.Js Rollups&nbsp;&mdash; Leaena.com</title><link href="/favicon.png" rel="icon"><link rel="alternate" href="/atom.xml" title="config.title" type="application/atom.xml"><link href="http://fonts.googleapis.com/css?family=Open+Sans:400" rel="stylesheet"><link href="http://fonts.googleapis.com/css?family=Source+Code+Pro:400,600" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/stylesheets/app.css"></head><body><header id="page-header"><div id="masthead"><h1 id="site-title"><a href="/">Leaena.com</a></h1><p id="site-slogan">Coding, cats, California, feminism, and zombies. Your average girl blogger.</p></div></header><section id="content"><article class="post"><h2>D3.Js Rollups</h2><div class="meta">Jan 4 2014 in <a href="/categories/Tech-Tips/">Tech Tips</a>&ensp;</div><p>Do you have all the data and none of the visuals? Do you just want a pretty, fast way to compare lots of data that centers around maybe just a handful of moments?</p>
<p><a href="http://d3js.org/" target="_blank" rel="external">D3.js</a> can help you tame all of your data and <code>d3.rollup</code> is especially useful if you have lots of data that you need to combine into just a couple of data points. All it takes is a couple of (pretty long) lines of code and you will have an awesome visual that’s very customizable.</p>
<p>Lets start with a really straightforward example of a rollup. In all of these examples, I’m using code straight from my HeatVote project, which requires me to pull voting data from our server API that I receive as a <a href="http://jsonblob.com/" target="_blank" rel="external">JSON blob</a>. Here’s an example entry:</p>
<pre><code>{ video_id: 'T-D1KVIuvjA',
  timestamp: <span class="number">2</span>,
  vote: <span class="number">1</span>,
  <span class="property">id</span>: <span class="number">1</span>,
  createdAt: Sat Dec <span class="number">21</span> <span class="number">2013</span> <span class="number">14</span>:<span class="number">55</span>:<span class="number">42</span> GMT-<span class="number">0800</span> (PST),
  updatedAt: Sat Dec <span class="number">21</span> <span class="number">2013</span> <span class="number">14</span>:<span class="number">55</span>:<span class="number">42</span> GMT-<span class="number">0800</span> (PST) }`&lt;/pre&gt;
Now obviously there are a bunch <span class="keyword">of</span> these, <span class="keyword">and</span> technically there are easier ways <span class="keyword">to</span> do this, <span class="keyword">but</span> <span class="keyword">to</span> show off <span class="keyword">the</span> structure <span class="keyword">of</span> a rollup, lets <span class="command">count</span> how many entries we had <span class="keyword">in</span> our database using a d3 rollup!
&lt;pre&gt;`var total = d3.nest()
  .rollup(function(d){
<span class="command">    return</span> d.<span class="property">length</span>;
  })
  .entries(data);`&lt;/pre&gt;
Remember, `data` here <span class="keyword">is</span> <span class="keyword">my</span> array <span class="keyword">of</span> JSON entries, so <span class="keyword">in</span> our rollup function <span class="keyword">the</span> `d` <span class="keyword">is</span> just shorthand <span class="keyword">for</span> all <span class="keyword">of</span> <span class="keyword">the</span> data. This <span class="keyword">isn't</span> a very interesting example though, lets take a look <span class="keyword">at</span> something <span class="keyword">that</span> really shows off <span class="keyword">the</span> beauty <span class="keyword">of</span> a d3 rollup.
&lt;pre&gt;`var averages = d3.nest()
  .key(function(d) {
<span class="command">    return</span> d.timestamp; 
  })
  .sortKeys(d3.ascending)
  .rollup(function(d){
<span class="command">    return</span> d3.mean(d, function(g) { 
<span class="command">      return</span> +g.vote;
    });
   })
   .entries(data);
</code></pre><p>Now there is a <strong>lot</strong> going on in this very compact few lines, so well go through them one by one, but the result is that <code>averages</code> is equal to an array of objects with the properties <code>key</code> (that is equal to each unique timestamp) and <code>value</code> (that is equal to the mean of all votes at that timestamp).</p>
<p>So lets break it down:</p>
<ul>
<li><code>.key(...)</code> is just used to tell the function what our keys are, only grabbing unique values of that property.</li>
<li><code>.sortKeys</code> is just a prettiness thing, it sorts my keys into an order (when they’re pulled off the server the only order is by the time they were created on the database).</li>
<li>and finally our lovely <code>.rollup(...)</code>. Now instead of d being an array of the whole data, it’s now an array of only the data for each individual key (so all of the data with the same timestamp). The inner function <code>d3.mean</code> takes a specific property from all of the data for each key and averages them up.<br>And that, is d3 rollup in a nutshell, it’s really lovely at coercing relationships out of your raw data and you can obviously do a lot more with it that just averaging things. The <a href="https://github.com/mbostock/d3/wiki/Arrays#wiki-d3_nest" target="_blank" rel="external">d3 nest docs</a> are probably the next best place to look to get your hands dirty (.rollup is a property of nest).</li>
</ul>
</article><nav id="article-pagination"><a href="/2014/01/week-7-is-this-what-confidence-feels-like/" title="Previous article: Week 7: Is This What Confidence Feels Like?" class="prev">&larr; Previous article</a><a href="/2013/12/cloud-postgresql-servers-with-heroku/" title="Next article: Cloud Postgre Sql Servers With Heroku" class="next">Next article &rarr;</a></nav></section><footer id="page-footer"><section><nav id="footer-menu"><ul><li><a href="/about">About</a></li><li><a href="/archives">Archive</a></li><li><a href="http://github.com/leaena/leaena.github.io">Source</a></li><li><a href="/atom.xml">Feed</a></li></ul></nav></section></footer></body></html>